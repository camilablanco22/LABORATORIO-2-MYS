<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Ruleta con Itamaracá</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 20px;
        }
        h2 {
            color: #4a90e2;
        }
        input, button {
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #4a90e2;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

<h2>Simulación del Juego de Ruleta con Itamaracá</h2>

<label for="numeroUsuario">Ingrese el número al que desea apostar (0-36):</label>
<input type="number" id="numeroUsuario" min="0" max="36">

<br>

<label for="valorApuesta">Ingrese el valor de la apuesta:</label>
<input type="number" id="valorApuesta" min="1">

<br>

<button onclick="simularJuego()">Simular</button>

<p id="resultado"></p>

<table id="tablaResultados">
    <thead>
        <tr>
            <th>Intento</th>
            <th>Número Ganador</th>
            <th>Tiempo de la Tirada (minutos)</th>
            <th>Pérdida Acumulada</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    // Probabilidad acumulada (F(x)) para cada número en la ruleta
    const probabilidadesAcumuladas = [
        0.027, 0.054, 0.081, 0.108, 0.135, 0.162, 0.189, 0.216, 0.243, 0.27,
        0.297, 0.324, 0.351, 0.378, 0.405, 0.432, 0.459, 0.486, 0.513, 0.54,
        0.567, 0.594, 0.621, 0.648, 0.675, 0.702, 0.729, 0.756, 0.783, 0.81,
        0.837, 0.864, 0.891, 0.918, 0.945, 0.972, 0.999
    ];

    // Generador de números pseudoaleatorios usando la técnica Itamaracá
    function itamaraca(seed, count) {
        let numbers = [];
        let x = seed;  // Semilla inicial
        for (let i = 0; i < count; i++) {
            x = (x * 997 + 43) % 1000;  // Fórmula simplificada
            numbers.push(x / 1000);  // Normalizado entre 0 y 1
        }
        return numbers;
    }

    // Función para generar un número aleatorio con Itamaracá
    let currentIndex = 0;  // Lleva la cuenta de los números generados
    let randomNumbers = itamaraca(Math.floor(Math.random() * 1000), 1000);  // Semilla aleatoria

    function getNextItamaraca() {
        if (currentIndex >= randomNumbers.length) {
            currentIndex = 0;  // Reiniciar si se acaban los números
        }
        return randomNumbers[currentIndex++];  // Retorna el siguiente número
    }

    // Función para generar un número ganador usando Itamaracá
    function generarNumeroGanador() {
        const u = getNextItamaraca();  // Obtiene el siguiente número de Itamaracá
        for (let i = 0; i < probabilidadesAcumuladas.length; i++) {
            if (u <= probabilidadesAcumuladas[i]) {
                return i;  // Número ganador
            }
        }
        return 36;  // Si llega aquí, es el último número (36)
    }

    // Función para calcular el tiempo entre jugadas usando Itamaracá
    function calcularTiempo() {
        const u = getNextItamaraca();  // Obtiene el siguiente número de Itamaracá
        return -5 * Math.log(u);  // Distribución exponencial
    }

    // Función para agregar una fila a la tabla de resultados
    function agregarFilaTabla(intentos, numeroGanador, tiempoTirada, perdidaAcumulada) {
        const tabla = document.getElementById("tablaResultados").getElementsByTagName("tbody")[0];
        let nuevaFila = tabla.insertRow();
        
        let celdaIntento = nuevaFila.insertCell(0);
        let celdaNumero = nuevaFila.insertCell(1);
        let celdaTiempo = nuevaFila.insertCell(2);
        let celdaPerdida = nuevaFila.insertCell(3);

        celdaIntento.textContent = intentos;
        celdaNumero.textContent = numeroGanador;
        celdaTiempo.textContent = tiempoTirada.toFixed(2);
        celdaPerdida.textContent = `$${perdidaAcumulada.toFixed(2)}`;
    }

    // Función para simular el juego
    function simularJuego() {
        const numeroUsuario = parseInt(document.getElementById("numeroUsuario").value);
        const valorApuesta = parseFloat(document.getElementById("valorApuesta").value);
        document.getElementById("resultado").textContent = "";

        if (isNaN(numeroUsuario) || numeroUsuario < 0 || numeroUsuario > 36 || isNaN(valorApuesta) || valorApuesta <= 0) {
            document.getElementById("resultado").textContent = "Por favor, ingrese un número válido entre 0 y 36 y un valor de apuesta positivo.";
            return;
        }

        // Limpiar tabla de resultados antes de iniciar
        const tabla = document.getElementById("tablaResultados").getElementsByTagName("tbody")[0];
        tabla.innerHTML = "";  // Vaciar las filas anteriores

        let tiempoTotal = 0;
        let intentos = 0;
        let numeroGanador = null;
        let perdidaAcumulada = 0;
        const pagoPorVictoria = valorApuesta * 36;  // Ganas 36 veces lo apostado

        // Simular hasta que el usuario gane
        while (numeroGanador !== numeroUsuario) {
            numeroGanador = generarNumeroGanador();  // Generar el número ganador usando Itamaracá
            const tiempoTirada = calcularTiempo();  // Calcular el tiempo de la tirada actual
            tiempoTotal += tiempoTirada;  // Acumular el tiempo total
            intentos++;
            perdidaAcumulada += valorApuesta;  // Se pierde la apuesta en cada tirada no ganada

            // Agregar la fila a la tabla de resultados
            agregarFilaTabla(intentos, numeroGanador, tiempoTirada, perdidaAcumulada);
        }

        // Cálculo del balance final
        const gananciaTotal = pagoPorVictoria - perdidaAcumulada;
        const resultadoFinal = gananciaTotal >= 0 ? "ganaste" : "perdiste";
        const balanceMensaje = gananciaTotal >= 0 ? "Ganaste dinero." : "Perdiste dinero.";

        // Mostrar el resultado final
        document.getElementById("resultado").textContent =
            `Ganaste apostando al número ${numeroUsuario} después de ${intentos} intentos. ` +
            `El tiempo total transcurrido fue de aproximadamente ${tiempoTotal.toFixed(2)} minutos. ` +
            `Has perdido un total de $${perdidaAcumulada.toFixed(2)} y ganaste $${pagoPorVictoria.toFixed(2)}. ` +
            `El balance total es $${gananciaTotal.toFixed(2)}. En resumen, ${balanceMensaje}`;
    }
</script>

</body>
</html>

